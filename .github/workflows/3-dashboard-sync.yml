name: ðŸŒ Dashboard Sync

on:
  schedule:
    - cron: '*/5 * * * *'
  push:
    paths:
      - '*.csv'
      - '*.png'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout trading repo
        uses: actions/checkout@v4
        with:
          path: trading
      
      - name: Checkout dashboard repo
        uses: actions/checkout@v4
        with:
          repository: winningtrendingbots/winningtrendingbots.github.io
          token: ${{ secrets.DASHBOARD_TOKEN }}
          path: dashboard
      
      - name: Create folders
        run: |
          mkdir -p dashboard/data dashboard/images
      
      - name: Copy files
        run: |
          cp trading/*.csv dashboard/data/ 2>/dev/null || true
          cp trading/*.json dashboard/data/ 2>/dev/null || true
          cp trading/*.png dashboard/images/ 2>/dev/null || true
      
      - name: Create metadata
        run: |
          cd dashboard
          echo "{\"last_sync\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"}" > data/metadata.json
      
      - name: Commit and push
        run: |
          cd dashboard
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add -A
          git diff --staged --quiet || git commit -m "Sync $(date +%Y-%m-%d)"
          git push
